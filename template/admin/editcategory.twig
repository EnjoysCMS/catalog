{% extends '../modules/catalog/template/admin/form.twig' %}

{% block additional %}
    {% do asset('css', [
        {0: 'modules/catalog/node_modules/select2/dist/css/select2.min.css','minify': false},
        {0: 'modules/catalog/node_modules/@ttskch/select2-bootstrap4-theme/dist/select2-bootstrap4.min.css','minify': false},
    ]) %}

    {% do asset('js', [
        {0: 'modules/catalog/node_modules/select2/dist/js/select2.full.min.js','minify': false }
    ]) %}
    <script>


        $(document).ready(
            function () {
                $("#title").on('click keyup', function () {
                    let query = 'query=' + $(this).prop('value');

                    (async () => {
                        let response = await fetch('{{ path('tools/translit') }}', {
                            method: 'POST',
                           headers: {'Content-Type':'application/x-www-form-urlencoded'},
                            body: query
                            // body: JSON.stringify({query: $(this).prop('value')})
                        });
                        let result = await response.text();
                        $("#url").val(result);
                    })();
                });
            }
        );




        $(document).ready(function(){
            $("#inputImage").on('click', function() {
                let width = 950;
                let height = 420;
                let params = [];
                params.push('height=' + height);
                params.push('width=' + width);
                params.push('left=' + (screen.width - width) / 2);
                params.push('top=' + ((screen.height - height) / 2) - 50 );

                window.open('{{ path('elfinder/popup') }}', 'FileBrowser', params.join(','));
            });
        });

        function processFile(file){
            $("#img").val(file.url);
        }

    </script>

    <script>
        $(function () {

            $(".set-extra-fields option").each(function() {
                $(this).removeAttr('id');
            });

            $(".set-extra-fields").select2({
                width: "100%",
                theme: 'bootstrap4',
                allowClear: true,
                placeholder :'select..',
                ajax: {
                    url: "{{ path('@a/catalog/tools/find-option-keys') }}",
                    dataType: 'json',
                    // delay: 250,
                    data: function (params) {
                        return {
                            query: params.term
                        };
                    },
                    processResults: function (data) {
                        return {
                            results: data
                        };
                    }

                },
                templateResult: function (result) {
                    if (result.loading) {
                        return result.text;
                    }

                    return result.name + result.unit;
                },
                templateSelection: function (result) {
                    return result.name + result.unit;
                }
            });

        });
    </script>
{% endblock %}